<!doctype html>
<html lang="en">

<head>
    <title>The Spoken World</title>
    <meta charset=utf-8 />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin="" />
    <!-- Marker Clusters -->
    <link rel="stylesheet" href="libs/Leaflet.markercluster/MarkerCluster.Default.css">
    <link rel="stylesheet" href="libs/Leaflet.markercluster/MarkerCluster.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Lato|Oswald" rel="stylesheet">
    <!--font-family: 'Oswald', sans-serif;
    font-family: 'Lato', sans-serif;-->
    <!-- Sidebar V-2 -->
    <link rel="stylesheet" href="libs/sidebar-v2/leaflet-sidebar.css" />
    <!-- Google Icons -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <style>
        body {
            padding: 0;
            margin: 0;
        }
        
        h1 {
            font-family: 'Oswald', sans-serif;
            font-size: 4.5em;
            color: white;
            text-align: center;
        }
        
        p {
            font-family: 'Lato', sans-serif;
            font-size: .9em;
        }
        
        html,
        body,
        #map {
            height: 100%;
            width: 100vw;
        }
    </style>
</head>

<body>
    <!--    <button id='pronun'><img src='/images/audio-test-two.png' alt="Click to listen" style="width:50px;height:50px;"></button>-->
    <div id="sidebar" class="sidebar collapsed">
        <!-- Nav tabs -->
        <div class="sidebar-tabs">
            <ul role="tablist">
                <li><a href="#home" role="tab"><i class="material-icons">toc</i></a></li>
                <li><a href="#search" role="tab"><i class="material-icons">search</i></a></li>
                <li><a href="#audio" role="tab"><i class="material-icons">hearing</i></a></li>
                <!--<li class="disabled"><a href="#messages" role="tab"><i class="fa fa-envelope"></i></a></li>
                <li><a href="https://github.com/Turbo87/sidebar-v2" role="tab" target="_blank"><i class="fa fa-github"></i></a></li>-->
            </ul>
            <ul role="tablist">
                <li><a href="#settings" role="tab"><i class="material-icons">settings</i></a></li>
            </ul>
        </div>
        <!-- Tab panes -->
        <div class="sidebar-content">
            <div class="sidebar-pane" id="home">
                <h1 class="sidebar-header">
                    sidebar-v2
                    <span class="sidebar-close"><i class="material-icons">chevron_left</i></span>
                </h1>
                <p>A responsive sidebar for mapping libraries like <a href="http://leafletjs.com/">Leaflet</a> or <a href="http://openlayers.org/">OpenLayers</a>.</p>
                <p class="lorem">Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</p>
                <p class="lorem">Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</p>
                <p class="lorem">Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</p>
                <p class="lorem">Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</p>
            </div>
            <div class="sidebar-pane" id="audio">
                <h1 class="sidebar-header">Audio<span class="sidebar-close"><i class="material-icons">chevron_left</i></span></h1> </div>
            <div class="sidebar-pane" id="search">
                <h1 class="sidebar-header">Search<span class="sidebar-close"><i class="material-icons">chevron_left</i></span></h1> </div>
            <div class="sidebar-pane" id="settings">
                <h1 class="sidebar-header">Settings<span class="sidebar-close"><i class="material-icons">chevron_left</i></span></h1> </div>
        </div>
    </div>
    <div id="map" class="sidebar-map"> </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js" integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg==" crossorigin=""></script>
    <script src='https://api.mapbox.com/mapbox.js/v3.2.0/mapbox.js'></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
    <script src="https://d3js.org/d3-dsv.v1.min.js"></script>
    <script src="https://d3js.org/d3-fetch.v1.min.js"></script>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="libs/sidebar-v2/leaflet-sidebar.js"></script>
    <script>
        // create map
        L.mapbox.accessToken = 'pk.eyJ1IjoibWlrdXMzMSIsImEiOiJjanVrNGgyaTIxcDNpM3lwaXB3dnowa2VpIn0.uNKvtTY9Is0M7xKSl_ukjQ';
        var map = L.mapbox.map('map').addLayer(L.mapbox.styleLayer('mapbox://styles/mikus31/cjajul8jxb6212rq7ly2wgenz'));
        // .setView([65, -19], 7)
        // allow map to access user's location?
        /*map.locate({
            setView: true
            , maxZoom: 16
        });*/
        // create custom marker icon
        var audioIcon = L.icon({
            iconUrl: 'images/marker-red.png'
            , iconSize: [40, 40], // size of the icon 
            iconAnchor: [20, 20], // point of the icon which will correspond to marker's location 
            popupAnchor: [0, 0]
                // point from which the popup should open relative to the iconAnchor 
        });
        // load places geojson and call function to add data to map
        $.getJSON("data/places-newtable.geojson", function (data) {
            drawPlaces(data);
        });
        d3.select('#pronun').on('click', function () {
            placeName = 'Reykjavik'
            url = 'https://apifree.forvo.com/key/f08a91897cb826f93096d8ea72e87c4e/format/json/action/word-pronunciations/word/' + placeName + '/language/en'
            getPath(url);
        });
        // add sidebar to map
        var sidebar = L.control.sidebar('sidebar').addTo(map);

        function drawPlaces(data) {
            var places = L.geoJson(data);
            // set the zoom/center to the extent of the geojson
            map.fitBounds(places.getBounds());
            // and then zoom in a tad
            map.setZoom(map.getZoom() + .5);
            // create new markerClusterGroup
            var markers = L.markerClusterGroup();
            // loop through all the features
            data.features.forEach(function (feature) {
                // create a new Leaflet marker for each
                var coords = feature.geometry.coordinates
                    , marker = L.marker([coords[1], coords[0]], {
                        icon: audioIcon
                    });
                // create a tooltip for the markers ...
                var props = feature.properties;
                // console.log(props.nameascii);
                var placesPopup = props.nameascii;
                // ... and bind it to the markers
                marker.bindTooltip(placesPopup);
                // add the individual markers to the markerClusterGroup
                markers.addLayer(marker);
            });
            // add the markerClusterGroup to the map
            map.addLayer(markers);
        }

        function getPath(path) {
            $.ajax({
                url: path
                , type: 'GET'
                , dataType: 'jsonp'
                , cors: true
                , contentType: 'application/json'
                , secure: true
                , headers: {
                    'Access-Control-Allow-Origin': '*'
                , }
                , beforeSend: function (xhr) {
                    xhr.setRequestHeader("Authorization", "Basic " + btoa(""));
                }
                , success: function (data) {
                    let mp3Path = data.items[0].pathmp3;
                    let oggPath = data.items[0].pathogg;
                    d3.select('audio').remove();
                    d3.select('body').append('audio').attr('controls', '').append('source').attr('type', 'audio/mpeg').attr('src', mp3Path)
                    d3.select('audio').append('source').attr('type', 'audio/ogg').attr('src', oggPath)
                }
            })
            console.log(url);
        }
    </script>
</body>

</html>